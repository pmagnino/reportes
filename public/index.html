<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Consulta de Facturas</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="p-4 bg-light">

<div class="container">

  <h3 class="mb-4">Consulta de Facturas</h3>

  <div class="row g-3">
    <div class="col-md-3">
      <label class="form-label">Sucursal</label>
      <input type="number" id="sucursal" class="form-control" value="101">
    </div>

    <div class="col-md-3">
      <label class="form-label">Desde</label>
      <input type="date" id="desde" class="form-control">
    </div>

    <div class="col-md-3">
      <label class="form-label">Hasta</label>
      <input type="date" id="hasta" class="form-control">
    </div>

    <div class="col-md-3 d-flex align-items-end">
      <button class="btn btn-primary w-100" onclick="buscar()">Buscar</button>
    </div>
  </div>

  <hr>

  <div id="resultado"></div>

</div>

<script>
async function buscar() {
  const sucursal = document.getElementById('sucursal').value
  const desde = document.getElementById('desde').value
  const hasta = document.getElementById('hasta').value

  let url = `/api/facturas?sucursal=${sucursal}`

  if (desde) url += `&desde=${desde}`
  if (hasta) url += `&hasta=${hasta}`

  const res = await fetch(url)
  const data = await res.json()

  let html = ''

  if (data.length === 0) {
    html = `<div class="alert alert-warning">No hay resultados</div>`
  }

  data.forEach(f => {
    html += `
      <div class="card mb-3">
        <div class="card-header">
          Factura ${f.prefijo}-${f.numero} | ${new Date(f.fecha).toLocaleDateString()}
        </div>
        <ul class="list-group list-group-flush">
          ${f.items.map(i =>
            `<li class="list-group-item d-flex justify-content-between">
              <span>${i.codigo}</span>
              <strong>${i.cantidad}</strong>
            </li>`
          ).join('')}
        </ul>
      </div>
    `
  })

  document.getElementById('resultado').innerHTML = html
}
</script>

</body>
</html>
